{% extends "index.html" %}
{% block content %}
{% set section = namespace(value=0) %}
{#
    Reference
    Index : Column Name
        0 : id
        1 : type
        2 : title
        3 : content
        4 : user_id
        5 : date
        6 : like
        7 : dislike
        8 : username
        9 : grade
#}
<div class="page_head">
    <h1>
        {# title #}
        {{ page[2] }}
    </h1>
    <h2>
        {# type #}
        {{ page[1] }}
    </h2>
    {# user_id, username, date #}
    <a href="{{ url_for('dashboard', id=page[4])}}">{{ page[8] }}</a> ● {{ page[5][6:] }} / {{ page[5][4:6] }} / {{ page[5][:4] }}
</div>
<div class="page_body">
    <p>
        {# content #}
        {{ page[3] }}
    </p>
</div>
<form class="grade" action="{{ url_for('grade', id=post[0]) }}" method="POST" enctype="application/x-www-form-urlencoded">
    <input type="hidden" name="table" value="Post">
    <input type="hidden" name="section" value="{{ section.value }}">
    {# likes #}
    {{ post[6] }}
    <input type="submit" name="grade" value="Like">
    {# dislikes #}
    {{ post[7] }}
    <input type="submit" name="grade" value="Dislike">
</form>
{% endif %}
<div class="page_foot"></div>
    <h3>
        Comments
    </h3>
    {% if session["user_id"] is defined %}
        <div id="comment_form">
            <form action="/create_comment" method="POST" enctype="application/x-www-form-urlencoded">    
                <textarea name="comment_content" cols="30" rows="10" placeholder="Your comment" required></textarea><br>
                <input type="hidden" name="post_id" value="{{ page[0] }}">
                <input type="submit" value="Post">
            </form>
        </div>
    {% endif %}
    <!-- Comment and reply reference
    Index : Column
        0 : id
        1 : user_id
        2 : post_id
        3 : comment_id
        4 : content
        5 : like
        6 : dislike
        7 : date -->
    <ul>
        {% for comment in comment %}
            {% set section.value = section.value + 1 %}
            <li id="{{ section.value }}"> 
                <div class="comment">
                    <p>
                        <a href="{{ url_for('dashboard', id=comment[1])}}">{{ comment[8] }}</a> ● {{ comment[7][6:] }} / {{ comment[7][4:6] }} / {{ comment[7][:4] }}
                    </p>
                    <p>
                        {{ comment[4] }}
                    </p>
                    <p>
                        likes {{ comment[5] }}
                    </p>
                    <p>
                        dislikes {{ comment[6] }}
                    </p>
                    {% if session["user_id"] is defined %}
                        <form action="{{ url_for('grade', id=comment[0]) }}" method="POST" enctype="application/x-www-form-urlencoded">
                            <input type="hidden" name="section" value="{{ section.value }}">
                            <input type="hidden" name="table" value="Comment">
                            <input type="submit" name="grade" value="Like">
                            <input type="submit" name="grade" value="Dislike">
                        </form>
                    {% endif %}
                </div><br>
                <div class="reply">
                    {% if session["user_id"] is defined %}
                        <form action="{{ url_for('reply_to', post_id=page[0], comment_id=comment[0]) }}">
                            <input type="submit" value="Reply to comment">
                        </form>
                    {% endif %}
                    <ul>
                        <!-- Check if the reply "comment_id" id is the same as the comment "id" -->
                        <!-- This checks if the reply is with the corresponsing comment -->
                        {% for reply in reply %}
                            {% if reply[3] == comment[0] %}
                                {% set section.value = section.value + 1 %}
                                <li id="{{ section.value }}">
                                    <p>
                                        <a href="{{ url_for('dashboard', id=reply[1])}}">{{ reply[8] }}</a> ● {{ reply[7][6:] }} / {{ reply[7][4:6] }} / {{ reply[7][:4] }}
                                    </p>
                                    <p>
                                        {{ reply[4] }}
                                    </p>
                                    <p>
                                        Likes : {{ reply[5] }}
                                    </p>
                                    <p>
                                        Dislikes : {{ reply[6] }}
                                    </p>
                                    {% if session["user_id"] is defined %}
                                        <form action="{{ url_for('grade', id=reply[0]) }}" method="POST" enctype="application/x-www-form-urlencoded">
                                            <input type="hidden" name="section" value="{{ section.value }}">
                                            <input type="hidden" name="table" value="Comment">
                                            <input type="submit" name="grade" value="Like">
                                            <input type="submit" name="grade" value="Dislike">
                                        </form>
                                    {% endif %}
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </div>
            </li>
        {% endfor %}
    </ul>
</div>
{% endblock %}
